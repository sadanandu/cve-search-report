import pymongo
import json
#import requests

# from flask import current_app, g
# from flask.cli import with_appcontext
#
#
# def get_db():
#     if 'db' not in g:
#         g.db = connect_to_mongodb()
#         #g.db.row_factory = sqlite3.Row
#
#     return g.db
#
#
# def close_db(e=None):
#     db = g.pop('db', None)
#
#     if db is not None:
#         db.close()

def connect_to_mongodb():
    return pymongo.MongoClient("mongodb+srv://supersada:75NHIDchTbod7G8y@cluster101-agkiq.mongodb.net/CVE")

#print(dir(client))
#db = client.get_database('101')
#print(db)
#print(dir(db))
# people = db.get_collection('people')
# print(people)
# personDocument = {
#   "name": { "first": "Alan", "last": "Turing" },
#   "birth": datetime.datetime(1912, 6, 23),
#   "death": datetime.datetime(1954, 6, 7),
#   "contribs": [ "Turing machine", "Turing test", "Turingery" ],
#   "views": 1250000
# }
# people.insert_one(personDocument)
# print(people.find_one({ "name.last": "Turing" }))

# system = db.system
# #print(dir(system))
# systemDocument = [
#         {"name" : "India",
#     "Type" : "Fraud"},
#     {"name" : "US",
#     "Type" : "MoreFraud"}
#     ]
# system.insert_many(systemDocument)
# print(system.find_one({"name": "India"}))
#print(dir(client))
client = connect_to_mongodb()
db = client.get_database("CVE")
cve = db.get_collection("cve_item")

def insert_cves_to_db_for_year():

    with open(r"C:\Users\sadanand.vu\Downloads\nvdcve-1.1-2020.json\nvdcve-1.1-2020.json", 'r', encoding="UTF-8") as f:
        j = json.load(f)
        cve.insert_many(j["CVE_Items"])

def search_cve(search_criteria):
    for each in cve.find(search_criteria):
        print(each)



#search_cve({"cve.CVE_data_meta.ID" : "CVE-2020-0001"})
#search_cve({"impact.baseMetricV3.cvssV3.baseScore" : {"$gt": 9}})
#search_cve({"configurations.nodes.cpe_match.cpe23Uri" : {"$regex": "android"}})